# Shoe Outsole Impression Evidence {#shoe}

#### *Authors* {-}

![Source: https://www.pexels.com/photo/grayscale-photo-of-shoe-sole-163369/](img/shoesole.png)

## Introduction

In the mess of a crime scene, one of the most abundant pieces of evidence is a shoe outsole impression [@bodziak2017footwear]. A shoe outsole impression is the trace of a shoe that is left behind when the pattern of the sole is transferred to the walking surface. Impressions are also often left in pliable materials such as sand, dirt, snow, or blood. These crime scene impressions are lifted using dusting or casting techniques to obtain the print left behind.  


Once we find shoe outsole impression(s) at the crime scene, the questions of interest are

- Who left the impression(s)? 
- How can we connect the shoe impression(s) to the perpetrator?

Suppose we have a database of shoe outsole impressions. We want to find the close images in the database to the questioned shoe impression(s) to determine the shoe brand, size, and other class characteristics. Alternatively, if we have information about potential suspects' shoes, then we need to investigate whether the questioned shoe impressions share characteristics. The summary statistic we need to assess is the degree of correspondence between questioned shoe outsole impression ($Q$) and known shoeprint ($K$). If the similarity between $Q$ and $K$ is high enough, then we may conclude that the source for $Q$ and $K$ would be the same. Thus, the goal is to quantify the degree of correspondence between two shoe outsole impressions.  


### Sources of variability in shoe outsole impressions

There are many characteristics of shoes that are examined. First, the size of the shoe is determined, then the style and manufacturer. These characteristics are known as *class characteristics*: there are many, many shoes that share these characteristics, but they can be used to easily exclude most other shoes that don't share the class. For instance, a very popular shoe in the United States is the Nike Air Force one, pictured below [@fbishoes]. So, seeing a Nike logo and concentric circles in an impression from a Men's size 13 instantly excludes all shoes that are not Nike Air Force Ones in Men's size 13.

```{r nikeaf1, echo = FALSE, out.width="75%", fig.cap="The outsole of a Nike Air Force One Shoe. This pattern is common across all shoes in the Air Force One model. Source: [nike.com](https://c.static-nike.com/a/images/t_PDP_1728_v1/f_auto/q3byyhcazwdatzj7si11/air-force-1-mid-07-womens-shoe-0nT1KyYW.jpg)"}
knitr::include_graphics("img/nikeshoewhite.png")
```

Next, *subclass characteristics* are examined. These characteristics are shared by a subset of elements in a class, but not by all elements in the class. In shoe impressions, subclass characteristics usually occur during the manufacturing process. For instance, air bubbles may form in one manufacturing run but not in another. Also, the different molds used to create the same style and size shoes can have slight differences, such as where pattern elements intersect [@mfrshoes]. Just like with class characteristics, subclass characteristics can be used to eliminate possible shoes very easily. 

Finally, the most unique parts of a shoe outsole impression are the randomly acquired characteristics (RACs) left behind. The RACs are smaller knicks, gouges, and debris in soles of shoes that are acquired over time, seemingly at random, as the shoes are worn. These are the *identifying* characteristics of shoe impressions, and examiners look for these irregularities in the crime scene impressions to make an identification. 


### Current practice 

Footwear examiners are tasked to compare $Q$ and $K$ by considering class, subclass and identifying characteristics on two impressions. Through the guideline comparing footwear impressions in the group of SWGTREAD, there are seven possible conclusions for comparing $Q$ and $K$ that an examiner can make: 

1. Lack sufficient detail (can't make a conclusion)
2. Exclusion
3. Indications of non-association 
4. Limited association of class characteristics 
5. Association of class characteristics
6. High degree of assocation 
7. Identification

Examiners rely on their knowledge and experience to conclude one of these seven conclusions, by investigating $Q$ and $K$ thoroughly. 


### The goal of this chapter 

In this chapter, we will show our algorithmic approach to measure the degree of similarity between two shoe outsole impression. For this, [CSAFE](https://forensicstats.org) collected shoe outsole impression data, developed the method for calculating similarity score between two shoe impressions and R package [`shoeprintr`](https://github.com/csafe-isu/shoeprintr) for the developed method. 

## Data 

Crime scene data that we can utilize to develop and test a comparison algorithm for footwear comparison is very limited for several reasons: 

1. Shoe impressions found at crime scenes are confidential because they are a part of a case involving real people.
2. Although some real, anonymized crime scene data is available, we typically don't know the true source of the impression.
3. Most shoe outsole impressions found at the crime scene are partial, degraded, or otherwise imperfect. They are not appropriate to develop and test an algorithm.  

### Data collection 

CSAFE collected shoe impressions using the two-dimensional EverOS footwear scanner from [Evident, Inc.](https://www.shopevident.com/product/everos-laboratory-footwear-scanner). The scanner is designed to scan the shoe outsole as the shoe wearer steps onto the scanner. As more pressure is put on the scanner, there will be more detailed patterns detected from the outsole. The resulting images have resolution of 300 DPI. In addition, the images show a ruler to allow analysts to measure the size of the scanned impression. Figure \@ref(fig:everosx) shows examples of impression images from the EverOS scanner. On the left, there are two replicates of the left shoe from one shoe style, while on the right, there are two replicates from the right shoe from a different shoe stle. The repeated impressions are very similar, but not exact because there are some differences in the amount and location of pressure from the shoe wearer while scanning.

```{r everosx, echo = FALSE, out.width="75%"}
knitr::include_graphics("img/everos_ex.PNG")
```


This scanner enables us to collect shoe impressions and make comparisons where ground truth is known. By collecting repeated impressions from the same shoe, we can make known mated comparisons, and we can make known non-mated comparisons from two different shoes. CSAFE collected a large collection of shoe outsole impressions from the EverOS scanner.


### Transformation of shoe image

The resulting image from the EverOS scanner is very large, making comparisons of images very time-consuming. To speed up the comparison process, we use only part of the image. By applying [edge detection](https://en.wikipedia.org/wiki/Edge_detection) to the images, we end up with comparisons of the outlines of important patterns of shoes. 

<!-- about down sampling. use edge detection, then get the x,y coordinates-->
?????????????????????? WAY too complicated for the book 
There could be some ways to compare 2D shoe impressions such as intensity based comparison or feature based comparison. That means, we will transform images into some information as we desire to use. In this chapter, we will use feature based method to compute the similarity score. As a feature, we choose to extract edges of impression by Prewitt operator and use its coordinate values of ($x$,$y$) with lower left corner of (0,0). By detecting the boundaries of sole pattern, edges will contain class, subclass and possible RACs all together as our information of shoe impressions.  As a preprocessing step, we used Matlab to down sample all of images at 20%.    



### Definition of classes


????????? Needs to be re-written 
To test the method and the signature we defined, we are using our data collection to come up with known mated (KM) comparisons and known non-mated (KNM) comparisons. The KMs are two repeated impressions from the same shoe source, while  the KNMs are from two different shoes. In the data collection, all of the shoes have the same class characteristics, so the the outsole pattern with no wear should be the same across the shoes. Based on results of KM and KNM, we will test the performance of the matching method whether it can discriminate well two classes, KM and KNM. Also, we want for the matching method to produce score distributions well separating two classes.  

<!-- for comparisons, the only difference between the shoes same brand, same size, worn by different people--> 
 

## R Package(s)

The R package `shoeprintr` was created to perform shoe outsole comparisons (Chapter 3 in @park2018learning).

To begin, the package can be installed from Github using [`devtools`](https://devtools.r-lib.org/):

```{r, eval=FALSE}
devtools::install_github("CSAFE-ISU/shoeprintr", force=TRUE)
```

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(shoeprintr)
library(ggplot2)
library(patchwork)
```


We propse a computer-assisted method to quantify the similarity between two impresssions. The method, called ?????, consists of several steps: 

1. Select "interesting" sub-areas in the $Q$ impression found at the crime scene.
2. Find the closest corresponding sub-areas in the $K$ impression.
3. Overlay sub-areas in $Q$ with the closest corresponding areas in $K$.
4. Define similarity features we can measure to create an outsole signature.
5. Combine those features into one single score. 

The data of two shoe impressions contain $x$ and $y$ coordinate values of impression area edges that we extracted from the original image. To start to compare subareas in $Q$ and $K$, we will select the three circular subareas ????? sub-area or subarea? of interest in $Q$. Here is the example matching between two repeated impressions from the same shoe.   


```{r datshoe, fig.cap="Outsole impressions of two shoes, $K$ and $Q$."}
shoeQ<-read.csv('dat/Q_03L_01.csv')
shoeK<-read.csv('dat/K_03L_05.csv')
shoeQ$source <- "Q"
shoeK$source <-  "K"

bind_rows(shoeQ, shoeK) %>% 
  ggplot() + 
  geom_point(aes(x = x, y = y), size = .05) + 
  facet_wrap(~source, scales = "free")
```
The data shoe $Q$ and shoe $K$ contain coordinate values ($x,y$) of edge points. There are 9,320 and 9,122 edges detected for boundaries of the soles of shoe $Q$ and $K$.
First, we select three circular areas by giving the information of their centers and radius arbitrary chosen. These areas can be selected by examiners or by computer. In this chapter, we will select manually those three circles in $Q$.

```{r qcircles}
input_circles <- matrix(c(75.25, 110, 170, 600.4, 150, 470, 50, 50, 50), nrow = 3, ncol = 3)
input_circles
```
For circle $q_1$, we select the center of (75.25, 600.4) and the radius of 50. The second and the third rows in this matrix show center and radius for circle $q_2, q_3$.  

```{r startplot, fig.align = 'center'}
start_plot(shoeQ, shoeK, input_circles)
```
Here, we can draw the graph of coordinates of edges from $Q$ and $K$. For $Q$, we can ask to color three circular areas that we fix. The command $start\_plot$ will produce graphs of $Q$ colored by three circular areas where red pixels are $q_1$, oranges are $q_2$, greens are $q_3$ and $K$ without coloring. The goal here is to find the same red, green, orange edges located in $K$.   

Let's look details how to find the corresponding areas in $K$ for $q_1$ with center of (75.25, 600.4) and radius of 50. 
```{r step1plot, fig.cap='Circle q1 in Q and candidate circles in K', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/step1_Q_K.png", dpi = 100)
```

For the comparison, we will select many candidate circles in $K$ labeled as circle $k_1$, ..., $k_9$ in Figure \@ref(fig:step1plot). For candidate circles in $K$, we use larger radius than circle $q_1$ because we want any of candidate circles can contain circle $q_1$ if they are mates. Ideally, the union of candidate circles in $K$ should contain entire edge points in $K$. However, we know that circle $q_1$ in $Q$ is located in the toe so that we limit the search area into upper left of $K$. We might try to compare circle $q_1$ to circles $k_7, k_8, k_9$ which are overlapped each other. As an example here, we will compare circle $q_1$ with circle $k_8$. 

For the comparison of circle $q_1$ and circle $k_8$, we will use the concept of maximum clique. A graph is an object consited with vertices or nodes connected with edges or lines. When comparing two graphs, the maximum clique from two graphs is defined as the largest complete subgraph, meaning the subset of nodes with the same geometrical relationship between two graphs. In the shoe outsole comparison application, The interest features detected from impression are becoming vertices and the distances among them become edges. The maximum clique is a good tool to reflect the fact that geometrics in the patterns (at least class characteristics) of shoe outsole are not changing a lot. 

```{r mcgraph, fig.cap='caption', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/maxclique_ex2.png", dpi = 100)
```

In Figure \@ref(fig:mcgraph), we want to compare Image 1 and Image 2. In Image 1, a set of nodes is {a, b, c, d, e, f, g} and a set of nodes for Image 2 is {1, 2, 3, 4, 5, 6}. When we look closely, the distances bewteen 'a' and three 'd','e' and 'g' in Image 1 are the same with distances between '1' and three '3', '6' and '5'. This way, pairwise distances among corresponding nodes between twoo images should have the same geometrics and the set of largest complete correspondence between two images are \{'a1','d3','e6','g5'\}. This set is a set of maximum clique. Some nodes such as \{'b','c','f'\} in Image 1 and \{'2','4'\} in Image 2 are examples of noises that might be apppeared in the outsole impressions.
 
### One subarea matching

In this section, we will show the example matching one circle from $Q$ and the other circle from $K$, using maximum clique. As a reminder, shoe $Q$ and $K$ are the mated pairs of images from the same shoe. As an example, we will shoe the matching between circle $q_1$ and circle $k_8$ in Figure \@ref(fig:step1plot). We selected the circle $k_8$ on purpose to be matched with the circle $q_1$ well.  

```{r onecircle, eval=FALSE}
nseg=360
circle_q1<-data.frame(int_inside_center(data.frame(shoeQ), 50, nseg, 75.25, 600.4))
circle_k8<-data.frame(int_inside_center(data.frame(shoeK), 65, nseg, 49, 700))

match_q1_k8<-boosted_clique(circle_q1, circle_k8, ncross_in_bins = 30, xbins_in = 20, 
                            ncross_in_bin_size = 1, ncross_ref_bins = NULL, xbins_ref = 30, 
                            ncross_ref_bin_size = NULL, eps = 0.75, seed = 1, num_cores = parallel::detectCores(), 
                            plot = TRUE, verbose = FALSE, cl = NULL)
```


A function $boosted\_clique$ is finding the set of maximum clique on the parallelized version to speed up from two sets of pixel, given some parameters. Using the set of maximum clique which is the corresponding sub-pixels, it will compute rotation angle and translation metric to result the best alignment. The function $boosted\_clique$ will produce a resulting plot in Figure \@ref(fig:MCresult) and a table of similarity features in Table \@ref(tab:resulttable). 

```{r MCresult, fig.cap='Resulting plot when comparing circle q1 and circle k8', fig.align = 'center', echo=FALSE}
knitr::include_graphics("img/MC_result.png", dpi = 100)
```

Figure \@ref(fig:MCresult) have four sections. In the first row and first column, it showed distances between pixels defined as maximum clique. Distances among points in the maximum clique should be aligned through the diagonal line, if they are correctly found as corresponding pixels. In the first row and second column, it shows the maximum clique where blue pixels are in circle $q_1$ and red pixels are in circle $k_8$, after aligning them. Using those maximum clique points, entire edges in circle $q_1$ is transformed to the plane of circle $k_8$. In the second row, two plots show the alignment result of circle $q_1$ and circle $k_8$. The plot on the second row and second column shows the area of red pixels that are overlapped the best with blue pixels. This figure is to calculate the radius and center for the corresponding circle in $K$ for circle $q_1$. Thus, we see only blue pixels from circle $q_1$, but red pixels from circle $k_8$ is behind blue pixels. 


```{r resulttable, results='asis', echo=FALSE}
tabb <- data.frame(c(18, 12.05, 0.75, 0.97, 0.3, 54.5, 688.5, 50.28))
tabb <- data.frame(t(tabb))
tabb %>% knitr::kable(format = "html", caption="Resulting table from the matching betwen q1 and k8", longtable = FALSE,
                      row.names = FALSE, col.names = c("Clique size","Rot. angle","Overlap on k8", "Overlap on q1","Median distance", "center x", "center y", "radius"))
```

Table \@ref(tab:resulttable) shows some similarity features and information of found circle in $K$ for circle $q_1$.  First five features are similarity values to measure the degree of similarity between circle $q_1$ and circle $k_8$, after aligning them. Here are the interpretations of Table \@ref(tab:resulttable); There are 18 number of pixels found from two circles as the maximum clique. The rotation angle is estimated as 12.15 degree to have the best overlap between two circles. There are two overlap features, meaning that 75% of circle $k_8$  pixels are overlapped with circle $q_1$ and 97% of circle $q_1$ pixels are overlapped with circle $k_8$. The median value of distances from overlapping points between two circles after aligning them is 0.3. For clique size, overlap features, the more the better and for median distance, the lower the better for mates. The last three columns are about information of the found circle in $K$ that is matched the best with circle $q_1$. Thus, the center (54.5, 688.5) and the radius 50.28 in $K$ will provide the best matching circle with circle $q_1$.
 

```{r graphq1, fig.cap='caption', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/graph_q1.png", dpi = 100)
```

The Figure \@ref(fig:graphq1) shows the matching result. By fixing circle $q_1$ (blue pixel), we found the closest circle (red pixel) for circle $q_1$ in shoe $K$, using circle information in Table \@ref(tab:resulttable). The blue circle in $Q$ and red circle in $K$ look pretty similar. We will repeat this process for two more circles that we fix in $Q$. 


## Drawing Conclusion

To draw the conclusion, we will define the signature of shoe outsole impressions. Once we define the signature of $Q$, then we will find the best match in $K$ for the signature of $Q$. As we saw in Figure \@ref(fig:startplot), we will fix three circurlar areas in $Q$ as the signature. The question is whether we can find the correspondin signature in $K$. By detecting edges, two shoe impressions are transformed into the boundaries of the outsole pattern containing class, subclass and existing RACs.  

```{r signature, fig.cap='caption', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/final3.png", dpi = 100)
```

Figure \@ref(fig:signature) shows the signature in $Q$ and the corresponding areas that we found as the best match in $K$ with the signature of $Q$. We will use the average of five similarity features from three circle matchings. If circles in $K$ are correctly found, then geometrics among three circles in $Q$ and $K$ should the similar. Here, you see the blue lines of traingle consituted by centers of three circles in each shoe impression. The difference of lengths from two traingles will be part of the similarity between $Q$ and $K$.  


```{r finaltable, results='asis', echo=FALSE}
X1<-c('q1-k*1',18, 12.05, 0.75, 0.97, 0.3, 0.58)
X2<-c('q2-k*2',17, 10.57, 0.53, 0.91, 0.43, 0.55)
X3<-c('q3-k*3',20, 12.14, 0.63, 1.00, 0.24, 1.03)

tabb2 <- data.frame(X1, X2, X3)
tabb2 <- data.frame(t(tabb2))
tabb2 %>% knitr::kable(format = "html", caption="Resulting table comparing Q and K.", longtable = FALSE,
                      row.names = FALSE, col.names = c("Comparison","Clique size","Rot. angle","Overlap on k*", "Overlap on q","Median distance", "Diff in length from Triangle"))
```

Table \@ref(tab:finaltable) is the resulting table once we fix the signature with three circles in $Q$, then find the corresponding areas in $K$ to show the best match with the signature in $Q$. Three rows are six similarity features between $q_i$ and $k^{*}_i$ (found as the best matching circle in $K$ for circle $q_i$) for $i=1,2,3$. The last column is the absolute value of difference of the triangle lengths from three circles in $Q$ and $K$, where the lower the better for mates. Finally, we will take the average of these features over three rows to summarize it, except rotation angle estimation. For mates, rotation angle will be consistently estimated so that we will summarise rotation angle feature as a standard deviaition of three rotation angle estimations. This will provide the evidence how much three rotation angle are consistently measured. 



## Case Study
Comparing two impressions with totally different outsole patterns are very easy problem to human examiner or computer. What if we are tasked to compare two impressions from the same brand and model shoes but used by two different users? 

Suppose we are tasked to compare one questioned shoe outsole impression ($Q$) and two known shoe impressions ($K_1, K_2$) from two different shoes. Let's confine the situation that all of three impressions share the same class characteristsis. How can we conclude the source of $Q$? Is the impression $Q$ from the source of $K_1$ or $K_2$?


```{r eximgs, fig.cap='Example images of shoe outsole impressions. The questioned impression (Q) and two known impressions (K1, K2). Q belongs to one of shoes for K1 and K2.', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/NIKE_QK1K2.jpg", dpi = 100)
```



Figure \@ref(fig:eximgs) display three outsole impressions. Impression $Q$ is from one of sources for $K_1$ and $K_2$. Two shoes are from the same brand and model of shoes, which were used by two different people for about six months. Since three impressions share the class and subclass characteristics, it is very hard comparison to conclude the source of $Q$. There are some differences among images $Q, K_1, K_2$ but it is hard to distinguish these differences are either measurement errors or wear and tear of the outsole (or RACs).  

### Comparison $Q$ vs. $K_1$
Let's compare $Q$ and $K_1$ first. In $Q$, we select three circlular areas. For this, we ask the function to select three centers of (30%, 80%), (20%, 40%), (70%, 70%) quantiles of $x, y$ ranges of coordinates in $Q$. 

```{r datshoe2, echo=FALSE}
imgQ<-read.csv('dat/lc_nike_10.5_647_Q.csv')
imgK1<-read.csv('dat/lc_nike_10.5_649_K1.csv')
imgK2<-read.csv('dat/lc_nike_10.5_520_K2.csv')
```


```{r cirQ}
input_circles_Q <- initial_circle(imgQ)
input_circles_Q
```
It automatically generate corresponding centers and radius of 50. 


```{r startQK1, fig.align = 'center'}
start_plot(imgQ, imgK1, input_circles_Q)
```
Here, we can draw the graph of $Q$ and $K_1$ with circles in $Q$. The goal is to find the correspoding circles in $K$ that matched well with circles in $Q$.



```{r matchKM, fig.align = 'center', eval=FALSE}
match_print(imgQ, imgK1, input_circles_Q)
```


```{r exKM, fig.cap='Final match result between Q and K1', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/Nike_edge_ex_KM.png", dpi = 100)
```

Figure \@ref(fig:exKM) shows the final matching result between $Q$ and $K_1$. In $K_1$, the algorithm finds the closest circle to show the best overlap with each circles that we fix in $Q$. 


```{r KMtable1, results='asis', echo=FALSE}
table_KM<-read.csv('dat/Nike_edge_ex_KM.csv')
table_KM$diff<-abs(table_KM$Euc_input_dist-table_KM$Euc_ref_dist)

table_KM[,3:5] %>% knitr::kable(format = "html", caption="Centers and radius information that the matching algorithm found as the best overlap circle in K for fixed circles in Q", longtable = FALSE, row.names = FALSE,  digits=2)
```

```{r KMtable2, results='asis', echo=FALSE}
table_KM[,c(6:10, 14)] %>% knitr::kable(format = "html", caption="Similarity features by comparing circles in Q and circles that found as the best matching in K", longtable = FALSE, row.names = FALSE, digits=2)
```


Table \@ref(tab:KMtable1) and Table \@ref(tab:KMtable2) are output table that we can get from the function $match\_print$, but here, results are splitted into two tables. Table \@ref(tab:KMtable1) is the information of center and radius for three circles that showed the best overlap with three circles in $Q$. Table \@ref(tab:KMtable2) shows the similairty features from the matching between each circle in $Q$ and corresponding circle in $K_1$. Each row in Table  \@ref(tab:KMtable2) shows the similarity features from circle $q_i$ and circle $k^{*}_i$ when $i=1,2,3$. 



### Comparison $Q$ vs. $K_2$

We are comparing $Q$ and $K_2$. For $Q$, we selected the same three circles and ask the algorithm to find the best matching circles in $K_2$.  

```{r exKNM, fig.cap='caption', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/Nike_edge_ex_KNM.png", dpi = 100)
```

Figure \@ref(fig:exKNM) shows the final matching result. In this comparison, green circle in $K_2$ is not correctly found as the position of green circle in $Q$. 



```{r KNMtable1, results='asis', echo=FALSE}
table_KNM<-read.csv('dat/Nike_edge_ex_KNM.csv')
table_KNM$diff<-abs(table_KNM$Euc_input_dist-table_KNM$Euc_ref_dist)

table_KNM[,3:5] %>% knitr::kable(format = "html", caption="Centers and radius information that the matching algorithm found as the best overlap circle in K for fixed circles in Q", longtable = FALSE, row.names = FALSE,  digits=2)
```

```{r KNMtable2, results='asis', echo=FALSE}
table_KNM[,c(6:10, 14)] %>% knitr::kable(format = "html", caption="Similarity features by comparing circles in Q and circles that found as the best matching in K", longtable = FALSE, row.names = FALSE, digits=2)
```


Table \@ref(tab:KNMtable1) and Table \@ref(tab:KNMtable1) show the location information of matching circles in $K$ for fixed circle in $Q$ and similarity features. 


### Interpretation of comparisons of $Q, K_1$ and $Q, K_2$ 

To summarize similarity features from the match of the two impressions, we will take the average of each similarity feature across three circle matchings, except rotation angle estimations. For features such as clique size, Overlap on $k$ and Overlap on $q$, the larger value we have, the better for the mated comparison of two impressions. For features Median distance and absolute value of differences of lengths from two triangles in two impessions, the lower value we get, the better for the mates. For the rotation angle estimation, taking the average of them means nothing. It is more important to check how consistently three rotation angle values are estimated. Thus, we take the standard deviaion of rotation angle as the summarized value of the match of two impressions. 


```{r summarytable, results='asis', echo=FALSE}
D1<-table_KM[,c(6:10, 14)]
D1 %>% summarize(clique_size=mean(clique_size),
                sd_rot_angle=sd(rotation_angle),
                overlap_k=mean(reference_overlap),
                overlap_q=mean(input_overlap),
                med_dist=mean(med_dist_euc),
                diff_length=mean(diff)

)->D_KM

D2<-table_KNM[,c(6:10, 14)]
D2 %>% summarize(clique_size=mean(clique_size),
                sd_rot_angle=sd(rotation_angle),
                overlap_k=mean(reference_overlap),
                overlap_q=mean(input_overlap),
                med_dist=mean(med_dist_euc),
                diff_length=mean(diff)

)->D_KNM

Match<-c("Q-K1", "Q-K2")
data.frame(Match, rbind(D_KM, D_KNM)) %>% knitr::kable(format = "html", caption="Summary table of two comparisons of $Q-K_1$ and $Q-K_2$. Similarity features are averaged but rotation angles are summarised as standard deviation.", longtable = FALSE, row.names = FALSE, digits=2)

```


Table \@ref(tab:summarytable) shows the summarized similarity features from two comparisons we did for $Q-K_1$ and $Q-K_2$. In both comparisons, the average clique size and median distance look similar. The features to show big differences between these two comparisons are standard deviation (SD) of rotation angle estimations and difference in lengths from triangles. The comparison $Q-K_1$ shows three similar rotation estimations (1.23, 1.88, 2.68), while the comparison $Q-K_2$ shows different values of rotation estimations (1.87, 7.16, 32.93) in Table \@ref(tab:KMtable2) and Table \@ref(tab:KNMtable2). The comparison $Q-K_2$ shows a 5 times larger value of differences between lengths from triangles than the comparison of $Q-K_1$. In addition, the comparison $Q-K_1$ shows high overlap chance of 97% in average while the comparison of $Q-K_2$ shows 77% chance overlap in average. 



Finally, I want to let you know the truth. The impression $Q$ and $K_1$ is known mated pairs of images, which means they are repeated impressions from the same shoe. The impression $K_2$ is scanned from different shoe of the shoe for $Q$ and $K_1$. Because two shoes share the same class characteristics and worn by two different users for about six months, the comparisons we did here were hard cases. To see what typical values we will have for mates and non-mates, we need to do more analysis to get similarity features from many comparisons. In our later analysis, we will use random forest to combine scores of similarity features we define. More analysis and results from many more comaprisons can be found in [@park2018learning]. 







