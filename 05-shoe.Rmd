# Shoe Outsole Impression Evidence {#shoe}

#### *Authors* {-}

![Source: https://www.pexels.com/photo/grayscale-photo-of-shoe-sole-163369/](img/shoesole.png)

## Introduction

In the mess of a crime scene, one of the most abundant pieces of evidence is a shoe outsole impression (@bodziak2017footwear). A shoe outsole impression is the trace of a shoe that is left behind. The pattern of the sole is transferred to the walking surface. Impressions are also often left in pliable materials such as sand, dirt, snow, or blood. These crime scene impressions are lifted using dusting or casting techniques to obtain the print left behind.  


Once we find shoe outsole impression(s) at the crime scene, the question of interest is who left this impression or how can we connect this questioned shoe impression to the suspect. From the database of shoeprint, we want to find the closest shoeprint image to the questioned shoe impressions to give the hint of shoe brand. Or, if we have information about the suspect's shoes, then we need to investigate whether the questioned shoe impressions show the major similarity with shoes that the suspect have. Statistically, the summary statistic we need to assess is the degree of correspondence between questioned shoe outsole impression ($Q$) and known shoeprint ($K$). If the similarity between $Q$ and $K$ is high enough, then we may conclude that the source for $Q$ and $K$ would be the same. Thus, the goal is how to quantify the degree of correspondence between two shoe outsole impressions.  


### Sources of variability in shoe outsole impressions

There are many characteristics of shoes that are examined. First, the size of the shoe is determined, then the style and manufacturer. These characteristics are known as *class characteristics* because there are many, many shoes that share these characteristics, but they can be used to easily exclude most other shoes. For instance, a very popular shoe in the United States is the Nike Air Force one, pictured below [@fbishoes]. So, seeing a Nike logo and concentric circles in an impression from a Men's size 13 instantly excludes all shoes that are not Nike Air Force Ones in Men's size 13. 

![](https://c.static-nike.com/a/images/t_PDP_1728_v1/f_auto/q3byyhcazwdatzj7si11/air-force-1-mid-07-womens-shoe-0nT1KyYW.jpg)

Next, *subclass characteristics* are examined. These characteristics are shared by a subset of elements in a class, but not by all elements in the class. In shoe impressions, subclass characteristics usually occur during the manufacturing process. For instance, air bubbles may form in one manufacturing run but not in another. Also, the different molds used to create the same style and size shoes can have slight differences, such as where pattern elements intersect [@mfrshoes]. Just like with class characteristics, subclass characteristics can be used to eliminate possible shoes very easily. 

Finally, the most unique parts of a shoe outsole impression are the randomly acquired characteristics (RACs) left behind. The RACs are smaller knicks, gouges, and debris in soles of shoes that are acquired over time, seemingly at random, as the shoes are worn. These are the *identifying* characteristics of shoe impressions, and examiners look for these irregularities in the crime scene impressions to make an identification. 

To make an identification, a shoe that investigators think could have caused the print is studied for its class, subclass, and randomly acquired characteristics. 

1. Size 
2. Manufacturer (Nike, Adidas, Converse, etc.)
3. Style (Air Force One, Chuck Taylor All-Star, etc.)
4. Mold used in manufacture
5. Other manufacturing process variability
6. Randomly acquired characteristics (RACs)
    a. gouge
    b. rocks
    c. knicks 
7. Transfer of outsole to surface    
    
1-3 : class characteristics
4-5 : subclass characteristics
6 : indentifying characterisics
7 : random 


### Current practice 
Footwear examiners are tasked to compare $Q$ and $K$ by considering class, subclass and identifying characteristics on two impressions. Through the guideline comparing footwear impressions in the group of SWGTREAD, there are seven ranges of conclusion for comparing $Q$ and $K$ that examiner can make; (1) Lacks sufficient detail, (2) Exclusions, (3) Indications of non-association, (4) Limited association of class characteristics, (5) Association of class characteristics, (6) High degree of assocation and (7) Identification. Examiners rely on their knowledge and experience to conclude one of these seven concludsions, by investigating $Q$ and $K$, thoroughly. 


### The goal of this chapter 
In this chapter, we will show our approach to measure the degree of similarity between two shoe outsole impression. For this, CSAFE collected shoe impression data, developed the method for calculating similarity score between two shoe impressions and R package 'shoeprintr' for the developed method. 

## Data 

### Data collection 
Real data that we can utilize to test a matching algorithm for footwear comparison is very limited with the several reasons; (1) Shoe impressions found at the crime scene is credential because they are a part of evidences to link the suspect, (2)  Although some of real crime scene data is actually available, we don't know the true source of the impression, (3) Since most of shoe impressions found at the crime scene is partial, degraded, blurred or damaged, they are not appropriate to test the performance of developing algorithm.  


CSAFE collected shoe impressions using two-dimensional EverOS footwear scanner (\url{http://www.shopevident.com}{http://www.shopevident.com}). The scanner is designed to scan the shoe outsole as person step onto the scanner by recording the weight distribution. The scanned images are 300 dpi resolution. As more pressure is put on the scanner, then there will be more detailed patterns detected from the outsole. Also, the scanner is not only scanning the outsole details, but also it shows the yellow line of ruler to allow to measure the size of scanned impression. Figure \ref{everos_ex} shows the exmaple impressions scanned from EverOS scanner. First two left shoe images are replicated impressions from the same shoe of ID 1 and two right shoes are also replicated impressions from the same shoe of ID 2. By getting impressions repeatedly, the overall patterns are very similar but there are some measurement differences by different amount of pressure.


<img src="img/everos_ex.PNG">


This 2D EverOS scanner enables to collect shoe impressions with ground truth. By collecting replicated impressions from the same shoe, the comparison of known mates is possible and by comparing impressions from two different shoe, the known non-mates is available. CSAFE collected a large collection of shoe outsole impressions from EverOS scanner. We collected 150 shoes that are used for certain period of time and scanned the outsole impressions 5 times from each of left and right shoes. This results in 1,500 images of shoe outsole impressions. For shoe ID 1, there are 5 impressions from left shoe and 5 impressions from the right shoe. Some of impressions have the exact same shoe brand and model but most of shoes have different class characteristic.  


### Transformation of shoe impression
There could be some ways to compare 2D shoe impressions such as intensity based comparison or feature based comparison. That means, we will transform images into some information as we desire to use. In this chapter, we will use feature based method to compute the similarity score. As a feature, we choose to extract edges of impression by Prewitt operator and use its coordinate values of ($x$,$y$) with lower left corner of (0,0). By detecting the boundaries of sole pattern, edges will contain class, subclass and possible RACs all together as our information of shoe impressions.  As a preprocessing step, we used Matlab to down sample all of images at 20%.    



### Definition of classes
To test the method and the signature we defined, we are using our data collection to come up with known mated (KM) comparisons and known non-mated (KNM) comparisons. The KM means a match between two repeated impressions from the same shoe source. The KNM means a match between two impressions from two different shoes. By the data collection set up, all of shoes have the same class characteristics, meaning the outsole pattern with no wear should be the same across the shoes. Based on results of KM and KNM, we will test the performance of the matching method whether it can discriminate well two classes, KM and KNM. Also, we want for the matching method to produce score distributions well separating two classes.  
 



## R Package(s)

R package called 'shoeprintr' is developed for shoe outsole comparison (Chapter 3 in @park2018learning).

To begin, the package can be installed from CRAN:

```{r, eval=FALSE}
#devtools::install_github("CSAFE-ISU/shoeprintr", force=TRUE, lib= .libPaths()[1])
#library(shoeprintr)
# install from github for now
devtools::install_github("CSAFE-ISU/shoeprintr", force=TRUE)
```

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(shoeprintr)
library(ggplot2)
library(patchwork)
```



We propse a computer-assisted method to quantify the similarity between two impresssions. Here are steps:

1. Select ``interesting'' sub-areas in the $Q$ impression found at the crime scene.
2. Find the closest corresponding sub-areas in the $K$ impression.
3. Overlay sub-areas in $Q$ with the closest corresponding areas in $K$.
4. Define similarity features we can measure to create an outsole signature.
5. Combine those features into one single score. 

The data of two shoe impressions contain $x$ and $y$ coordinate values of edges that we extracted from the original image. To start to compare subareas in $Q$ and $K$, we will select the three circular subareas as our interest in $Q$. Here is the example matching between two repeated impressions from the same shoe.   


```{r dat}
shoeQ<-read.csv('dat/Q_03L_01.csv')
shoeK<-read.csv('dat/K_03L_05.csv')
dim(shoeQ)
dim(shoeK)
head(shoeQ)
```
The data shoe $Q$ and shoe $K$ contain coordinate values ($x,y$) of edge points. There are 9,320 and 9,122 edges detected for boundaries of the soles of shoe $Q$ and $K$.
First, we select three circular areas by giving the information of their centers and radius arbitrary chosen. These areas can be selected by examiners or by computer. In this chapter, we will select manually those three circles in $Q$.

```{r qcircles}
input_circles <- matrix(c(75.25, 110, 170, 600.4, 150, 470, 50, 50, 50), nrow = 3, ncol = 3)
input_circles
```
For circle $q_1$, we select the center of (75.25, 600.4) and the radius of 50. The second and the third rows in this matrix show center and radius for circle $q_2, q_3$.  

```{r startplot, fig.align = 'center'}
start_plot(shoeQ, shoeK, input_circles)
```
Here, we can draw the graph of coordinates of edges from $Q$ and $K$. For $Q$, we can ask to color three circular areas that we fix. The command $start\_plot$ will produce graphs of $Q$ colored by three circular areas where red pixels are $q_1$, oranges are $q_2$, greens are $q_3$ and $K$ without coloring. The goal here is to find the same red, green, orange edges located in $K$.   

Let's look details how to find the corresponding areas in $K$ for $q_1$ with center of (75.25, 600.4) and radius of 50. 
```{r step1plot, fig.cap='Circle q1 in Q and candidate circles in K', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/step1_Q_K.png", dpi = 100)
```

For the comparison, we will select many candidate circles in $K$ labeled as circle $k_1$, ..., $k_9$ in Figure \@ref(fig:step1plot). For candidate circles in $K$, we use larger radius than circle $q_1$ because we want any of candidate circles can contain circle $q_1$ if they are mates. Ideally, the union of candidate circles in $K$ should contain entire edge points in $K$. However, we know that circle $q_1$ in $Q$ is located in the toe so that we limit the search area into upper left of $K$. We might try to compare circle $q_1$ to circles $k_7, k_8, k_9$ which are overlapped each other. As an example here, we will compare circle $q_1$ with circle $k_8$. 

For the comparison of circle $q_1$ and circle $k_8$, we will use the concept of maximum clique. A graph is an object consited with vertices or nodes connected with edges or lines. When comparing two graphs, the maximum clique from two graphs is defined as the largest complete subgraph, meaning the subset of nodes with the same geometrical relationship between two graphs. In the shoe outsole comparison application, The interest features detected from impression are becoming vertices and the distances among them become edges. The maximum clique is a good tool to reflect the fact that geometrics in the patterns (at least class characteristics) of shoe outsole are not changing a lot. 

```{r mcgraph, fig.cap='caption', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/maxclique_ex2.png", dpi = 100)
```

In Figure \@ref(fig:mcgraph), we want to compare Image 1 and Image 2. In Image 1, a set of nodes is \{'a','b','c','d','e','f','g'\} and a set of nodes for Image 2 is \{'1','2','3','4','5','6'\}. When we look closely, the distances bewteen 'a' and three 'd','e' and 'g' in Image 1 are the same with distances between '1' and three '3', '6' and '5'. This way, pairwise distances among corresponding nodes between twoo images should have the same geometrics and the set of largest complete correspondence between two images are \{'a1','d3','e6','g5'\}. This set is a set of maximum clique. Some nodes such as \{'b','c','f'\} in Image 1 and \{'2','4'\} in Image 2 are examples of noises that might be apppeared in the outsole impressions.
 
### One subarea matching

In this section, we will show the example matching one circle from $Q$ and the other circle from $K$, using maximum clique. As a reminder, shoe $Q$ and $K$ are the mated pairs of images from the same shoe. As an example, we will shoe the matching between circle $q_1$ and circle $k_8$ in Figure \@ref(fig:step1plot). We selected the circle $k_8$ on purpose to be matched with the circle $q_1$ well.  

```{r onecircle, eval=FALSE}
nseg=360
circle_q1<-data.frame(int_inside_center(data.frame(shoeQ), 50, nseg, 75.25, 600.4))
circle_k8<-data.frame(int_inside_center(data.frame(shoeK), 65, nseg, 49, 700))

match_q1_k8<-boosted_clique(circle_q1, circle_k8, ncross_in_bins = 30, xbins_in = 20, 
                            ncross_in_bin_size = 1, ncross_ref_bins = NULL, xbins_ref = 30, 
                            ncross_ref_bin_size = NULL, eps = 0.75, seed = 1, num_cores = parallel::detectCores(), 
                            plot = TRUE, verbose = FALSE, cl = NULL)
```


A function $boosted\_clique$ is finding the set of maximum clique on the parallelized version to speed up from two sets of pixel, given some parameters. Using the set of maximum clique which is the corresponding sub-pixels, it will compute rotation angle and translation metric to result the best alignment. The function $boosted\_clique$ will produce a resulting plot in Figure \@ref(fig:MCresult) and a table of similarity features in Table \@ref(tab:resulttable). 

```{r MCresult, fig.cap='Resulting plot when comparing circle q1 and circle k8', fig.align = 'center', echo=FALSE}
knitr::include_graphics("img/MC_result.png", dpi = 100)
```

Figure \@ref(fig:MCresult) have four sections. In the first row and first column, it showed distances between pixels defined as maximum clique. Distances among points in the maximum clique should be aligned through the diagonal line, if they are correctly found as corresponding pixels. In the first row and second column, it shows the maximum clique where blue pixels are in circle $q_1$ and red pixels are in circle $k_8$, after aligning them. Using those maximum clique points, entire edges in circle $q_1$ is transformed to the plane of circle $k_8$. In the second row, two plots show the alignment result of circle $q_1$ and circle $k_8$. The plot on the second row and second column shows the area of red pixels that are overlapped the best with blue pixels. This figure is to calculate the radius and center for the corresponding circle in $K$ for circle $q_1$. Thus, we see only blue pixels from circle $q_1$, but red pixels from circle $k_8$ is behind blue pixels. 


```{r resulttable, results='asis', echo=FALSE}
tabb <- data.frame(c(18, 12.05, 0.75, 0.97, 0.3, 54.5, 688.5, 50.28))
tabb <- data.frame(t(tabb))
tabb %>% knitr::kable(format = "html", caption="Resulting table from the matching betwen q1 and k8", longtable = FALSE,
                      row.names = FALSE, col.names = c("Clique size","Rot. angle","Overlap on k8", "Overlap on q1","Median distance", "center x", "center y", "radius"))
```

Table \@ref(tab:resulttable) shows some similarity features and information of found circle in $K$ for circle $q_1$.  First five features are similarity values to measure the degree of similarity between circle $q_1$ and circle $k_8$, after aligning them. Here are the interpretations of Table \@ref(tab:resulttable); There are 18 number of pixels found from two circles as the maximum clique. The rotation angle is estimated as 12.15 degree to have the best overlap between two circles. There are two overlap features, meaning that 75% of circle $k_8$  pixels are overlapped with circle $q_1$ and 97% of circle $q_1$ pixels are overlapped with circle $k_8$. The median value of distances from overlapping points between two circles after aligning them is 0.3. For clique size, overlap features, the more the better and for median distance, the lower the better for mates. The last three columns are about information of the found circle in $K$ that is matched the best with circle $q_1$. Thus, the center (54.5, 688.5) and the radius 50.28 in $K$ will provide the best matching circle with circle $q_1$.
 

```{r graphq1, fig.cap='caption', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/graph_q1.png", dpi = 100)
```

The Figure \@ref(fig:graphq1) shows the matching result. By fixing circle $q_1$ (blue pixel), we found the closest circle (red pixel) for circle $q_1$ in shoe $K$, using circle information in Table \@ref(tab:resulttable). The blue circle in $Q$ and red circle in $K$ look pretty similar. We will repeat this process for two more circles that we fix in $Q$. 


## Drawing Conclusion

To draw the conclusion, we will define the signature of shoe outsole impressions. Once we define the signature of $Q$, then we will find the best match in $K$ for the signature of $Q$. As we saw in Figure \@ref(fig:startplot), we will fix three circurlar areas in $Q$ as the signature. The question is whether we can find the correspondin signature in $K$. By detecting edges, two shoe impressions are transformed into the boundaries of the outsole pattern containing class, subclass and existing RACs.  

```{r signature, fig.cap='caption', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/final3.png", dpi = 100)
```

Figure \@ref(fig:signature) shows the signature in $Q$ and the corresponding areas that we found as the best match in $K$ with the signature of $Q$. We will use the average of five similarity features from three circle matchings. If circles in $K$ are correctly found, then geometrics among three circles in $Q$ and $K$ should the similar. Here, you see the blue lines of traingle consituted by centers of three circles in each shoe impression. The difference of lengths from two traingles will be part of the similarity between $Q$ and $K$.  


```{r finaltable, results='asis', echo=FALSE}
X1<-c('q1-k*1',18, 12.05, 0.75, 0.97, 0.3, 0.58)
X2<-c('q2-k*2',17, 10.57, 0.53, 0.91, 0.43, 0.55)
X3<-c('q3-k*3',20, 12.14, 0.63, 1.00, 0.24, 1.03)

tabb2 <- data.frame(X1, X2, X3)
tabb2 <- data.frame(t(tabb2))
tabb2 %>% knitr::kable(format = "html", caption="Resulting table comparing Q and K.", longtable = FALSE,
                      row.names = FALSE, col.names = c("Comparison","Clique size","Rot. angle","Overlap on k*", "Overlap on q","Median distance", "Diff in length from Triangle"))
```

Table \@ref(tab:finaltable) is the resulting table once we fix the signature with three circles in $Q$, then find the corresponding areas in $K$ to show the best match with the signature in $Q$. Three rows are six similarity features between $q_i$ and $k^{*}_i$ (found as the best matching circle in $K$ for circle $q_i$) for $i=1,2,3$. The last column is the absolute value of difference of the triangle lengths from three circles in $Q$ and $K$, where the lower the better for mates. Finally, we will take the average of these features over three rows to summarize it, except rotation angle estimation. For mates, rotation angle will be consistently estimated so that we will summarise rotation angle feature as a standard deviaition of three rotation angle estimations. This will provide the evidence how much three rotation angle are consistently measured. 



## Case Study
Comparing two impressions with totally different outsole patterns are very easy problem to human examiner or computer. What if we are tasked to compare two impressions from the same brand and model shoes but used by two different users? 

Suppose we are tasked to compare one questioned shoe outsole impression ($Q$) and two known shoe impressions ($K_1, K_2$) from two different shoes. Let's confine the situation that all of three impressions share the same class characteristsis. How can we conclude the source of $Q$? Is the impression $Q$ from the source of $K_1$ or $K_2$?


```{r eximgs, fig.cap='Example images of shoe outsole impressions. The questioned impression (Q) and two known impressions (K1, K2). Q belongs to one of shoes for K1 and K2.', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/NIKE_QK1K2.jpg", dpi = 100)
```



Figure \@ref(fig:eximgs) are three outsole impressions. Impression $Q$ is from one of sources for $K_1$ and $K_2$. Two shoes are from the same brand and model of shoes, which were used by two different people for about six months. Since three impressions share the class and subclass characteristics, it is very hard comparison to conclude the source of $Q$. There are some differences among images $Q, K_1, K_2$ but it is hard to distinguish these differences are either measurement errors or wear and tear of the outsole (or RACs).  

### Comparison $Q$ vs. $K_1$
Let's compare $Q$ and $K_1$ first. In $Q$, we select three circlular areas. For this, we ask the function to select three centers of (30%, 80%), (20%, 40%), (70%, 70%) quantiles of $x, y$ ranges of coordinates in $Q$. 

```{r dat2, echo=FALSE}
imgQ<-read.csv('dat/lc_nike_10.5_647_Q.csv')
imgK1<-read.csv('dat/lc_nike_10.5_649_K1.csv')
imgK2<-read.csv('dat/lc_nike_10.5_520_K2.csv')
```


```{r cirQ}
input_circles_Q <- initial_circle(imgQ)
input_circles_Q
```
It automatically generate corresponding centers and radius of 50. 


```{r startQK1, fig.align = 'center'}
start_plot(imgQ, imgK1, input_circles_Q)
```
Here, we can draw the graph of $Q$ and $K_1$ with circles in $Q$. The goal is to find the correspoding circles in $K$ that matched well with circles in $Q$.



```{r matchKM, fig.align = 'center', eval=FALSE}
match_print(imgQ, imgK1, input_circles_Q)
```


```{r exKM, fig.cap='Final match result between Q and K1', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/Nike_edge_ex_KM.png", dpi = 100)
```

Figure \@ref(fig:exKM) shows the final matching result between $Q$ and $K_1$. In $K_1$, the algorithm finds the closest circle to show the best overlap with each circles that we fix in $Q$. 


```{r KMtable1, results='asis', echo=FALSE}
table_KM<-read.csv('dat/Nike_edge_ex_KM.csv')
table_KM$diff<-abs(table_KM$Euc_input_dist-table_KM$Euc_ref_dist)

table_KM[,3:5] %>% knitr::kable(format = "html", caption="Centers and radius information that the matching algorithm found as the best overlap circle in K for fixed circles in Q", longtable = FALSE, row.names = FALSE,  digits=2)
```

```{r KMtable2, results='asis', echo=FALSE}
table_KM[,c(6:10, 14)] %>% knitr::kable(format = "html", caption="Similarity features by comparing circles in Q and circles that found as the best matching in K", longtable = FALSE, row.names = FALSE, digits=2)
```


Table \@ref(tab:KMtable1) and Table \@ref(tab:KMtable2) are output table splitted into two parts. Table \@ref(tab:KMtable1) is the information of center and radius for three circles that showed the best overlap with three circles in $Q$. Table \@ref(tab:KMtable2) shows the similairty features from the matching between each circle in $Q$ and corresponding circle in $K$.



### Comparison $Q$ vs. $K_2$

```{r exKNM, fig.cap='caption', echo=FALSE, fig.align = 'center'}
knitr::include_graphics("img/Nike_edge_ex_KNM.png", dpi = 100)
```
